{{ define "main" }}
    <div class="hero">
        <div class="hero__content">
            <h1 class="title">L'Amuravela</h1>
            <blockquote class="introduction-quote">
                En el nombri de Jesús<br>
                y la Virgin Soberana,<br>
                vou ichar l'Amuravela<br>
                comu San Pedru asperaba.
            </blockquote>
            <a class="cta" href="{{($.Site.GetPage "/amuravelas/lamuravela-2021").Permalink}}">
                {{ i18n "readLast"}} <span class="arrow-right">&#8594;</span>
            </a>
        </div>
    </div>

    <section id="what">
        <div class="section__content">
            <h2 class="section__title">{{ i18n "whatT"}}</h2>
            <p>{{ i18n "whatP1"}}</p>
        </div>
    </section>

    <section id="where">
        <div class="section__content">
            <h2 class="section__title">{{ i18n "whereT"}}</h2>
            <p>{{ i18n "whereP1"}}</p>
            <a class="button" role="button" target="_blank" rel="noreferrer"
                href="https://www.google.es/maps/dir//43.5633611,-6.1458889/@43.5633611,-6.1480776,17z"
                aria-label="{{ i18n "howToGetThere"}}">{{ i18n "howToGetThere"}} <span class="arrow-right">&#8594;</span></a>
        </div>
    </section>

    <section id="when">
        <div class="section__content">
            <h2 class="section__title">{{ i18n "whenT"}}</h2>
            <p>{{ i18n "whenP1"}}</p>
            <p>
                {{ i18n "nextDateIs"}} <br/>
                <b><time id="date">...</time></b>
            </p>
            <div>
                <h3 id="share-cta-title">{{ i18n "gonnaWatchShareCTA"}}</h3>
                <div class="social-share">
                    <a class="social-share-button" id="share-button" role="button" target="_blank" rel="noreferrer" aria-label="{{ i18n "shareOn"}} {{ i18n "mobile"}}"></a>
                    <a class="social-share-button facebook" role="button" target="_blank" rel="noreferrer" aria-label="{{ i18n "shareOn"}} Facebook"
                        href="https://www.facebook.com/sharer/sharer.php?u=https://amuravela.com&p[title]={{ i18n "shareMessage"}}"></a>
                    <a class="social-share-button twitter" role="button" target="_blank" rel="noreferrer" aria-label="{{ i18n "shareOn"}} Twitter"
                        href="https://twitter.com/share?text={{ i18n "shareMessage"}}&url=https://amuravela.com"></a>
                    <a class="social-share-button pinterest" role="button" target="_blank" rel="noreferrer" aria-label="{{ i18n "shareOn"}} Pinterest"
                        href="http://pinterest.com/pin/create/button/?url=https://amuravela.com&description={{ i18n "shareMessage"}}"></a>
                    <a class="social-share-button whatsapp" role="button" target="_blank" rel="noreferrer" aria-label="{{ i18n "shareOn"}} WhatsApp"
                        href="https://api.whatsapp.com/send?text={{ i18n "shareMessage"}} https://amuravela.com"></a>
                </div>
            </div>
        </div>
    </section>

    {{ with .Site.GetPage "history" }}
        <section id="history">
            <div class="section__content">
                <h2 class="section__title">{{ i18n "historyT"}}</h2>
                <p>{{ i18n "historyP1"}}</p>
                <p>{{ i18n "historyP2"}}</p>
                <a class="button" role="button"
                    href="{{.Permalink}}"
                    aria-label="{{ i18n "historyT"}}">{{ i18n "readMore"}} <span class="arrow-right">&#8594;</span></a>
            </div>
        </section>
    {{ end }}

    {{ with .Site.GetPage "amuravelas" }}
        <section id="amuravelas">
            <div class="section__content">
                <h2 class="section__title">{{ i18n "amuravelasT"}}</h2>
                <p>{{ i18n "amuravelasP1"}}</p>
                <a class="button" role="button"
                    href="{{.Permalink}}"
                    aria-label="{{.Title}}">{{ i18n "readEveryAmuravela"}} <span class="arrow-right">&#8594;</span></a>
            </div>
        </section>
    {{ end }}

    {{ with .Site.GetPage "authors" }}
        <section id="authors">
            <div class="section__content">
                <h2 class="section__title">{{ i18n "authorsT"}}</h2>
                <p>{{ i18n "authorsP1"}}</p>
                <a class="button" role="button"
                    href="{{.Permalink}}"
                    aria-label="{{ i18n "seeEveryAuthor"}}">{{ i18n "seeEveryAuthor"}} <span class="arrow-right">&#8594;</span></a>
            </div>
        </section>
    {{ end }}

    {{ with .Site.GetPage "reciters" }}
        <section id="reciters">
            <div class="section__content">
                <h2 class="section__title">{{ i18n "recitersT"}}</h2>
                <p>{{ i18n "recitersP1"}}</p>
                <a class="button" role="button"
                    href="{{.Permalink}}"
                    aria-label="{{ i18n "seeEveryReciter"}}">{{ i18n "seeEveryReciter"}} <span class="arrow-right">&#8594;</span></a>
            </div>
        </section>
    {{ end }}

    <section>
        <blockquote class="closing-quote">
            ¡Amura vela! ¡Isa vela!<br>
            ¡Fuego a babor!¡Fuego a estribor!<br>
            ¡¡¡Viva Pedro!!!
        </blockquote>
    </section>

    <script defer>
        const menuLinks = document.querySelectorAll('nav.menu li');
        const mainSections = document.querySelectorAll('main section');

        menuLinks.forEach(v=> {
            v.onclick = (()=> {
                setTimeout(()=> {
                    menuLinks.forEach(j=> j.classList.remove('active'))
                    v.classList.add('active')
                }, 300)
            })
        });

        window.onscroll = (()=> {
            mainSections.forEach((v,i)=> {
                let rect = v.getBoundingClientRect().y
                if (rect < window.innerHeight - 500) {
                    menuLinks.forEach(v => v.classList.remove('active'))
                    menuLinks[i].classList.add('active')
                }
            })
        })
    </script>

    <script defer>
        // Calculate next event date
        const today = new Date();
        const year = today > new Date(today.getFullYear(), '06', '29') ? today.getFullYear() + 1 : today.getFullYear();
        const date = new Date (year, '06', '29', '13', '00');

        document.getElementById("date").setAttribute("datetime", date.toISOString());
        document.getElementById("date").innerText = date.toLocaleString('{{.Lang}}', {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'});

        if (today.valueOf() === date.valueOf()) {
            document.getElementById("share-cta-title").innerText = "{{ i18n "watchingShareCTA"}}";
        }

        // Trigger web share API when on mobile
        if (navigator.canShare) {
            const shareData = {
                title: "L'Amuravela",
                text: "{{ i18n "shareMessage"}}",
                url: 'https://amuravela.com'
            }
            // Share must be triggered by "user activation"
            document.getElementById('share-button').addEventListener('click', async () => {
                try {
                    await navigator.share(shareData);
                } catch(err) {
                    console.error(err);
                }
            });
        }
    </script>
{{ end }}
